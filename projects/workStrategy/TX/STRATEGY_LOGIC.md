# 台指期長線波段策略邏輯 (TX Long-term Strategy Logic)

## 1. 策略總覽 (Executive Summary)
本策略旨在捕捉台指期 (TX) 的長線多頭趨勢，同時透過嚴格的 **宏觀 (Macro)** 與 **日曆 (Calendar)** 濾網來規避系統性風險。策略核心在於 **「平時順勢，災後逆勢」**：
*   **平時 (Trend Following)**：利用均線乖離率 (Divergence) 捕捉右側動能。
*   **災後 (Event Driven)**：利用長假後的「紓壓反彈 (Relief Rally)」與宏觀安全訊號，進行左側抄底。

**適用商品**：台指期 (TX)
**交易頻率**：日頻 (Daily)，分為日盤 (08:45) 與夜盤 (15:00) 兩次決策點。
**持倉屬性**：長線波段 (Swing)，但在高風險期會轉為極短線或空手。

---

## 2. 核心因子詳解 (Factor Deep Dive)

### A. 宏觀因子：美債殖利率衝擊 (Yield Shock)
**邏輯**：美債殖利率是全球資產定價的錨 (Anchor)。當殖利率短時間內飆升，代表流動性緊縮或市場恐慌，對風險資產 (如台股) 極度不利。
*   **公式**：`US_Bond_5Y - US_Bond_5Y.shift(20)` (20日變動量)
*   **滯後處理 (Lag)**：`shift(3)`。
    *   *意義*：考量美債數據發布時間與市場反應傳遞到台股的時間差，避免使用未來數據。
*   **關鍵閥值 (Thresholds)**：
    *   **> 0.30 (Severe Shock)**：重度衝擊。市場處於崩潰邊緣，**禁止所有多單**。
    *   **> 0.15 (Mild Shock)**：輕度衝擊。市場有雜音，**暫停順勢交易** (除非有特殊訊號)。
    *   **< 0.18 (Safe Zone)**：安全區。此閥值是用於「聰明接刀」判斷，代表宏觀環境尚可忍受。

### B. 技術因子：均線乖離率 (Divergence)
**邏輯**：價格與均線的距離代表趨勢的強弱。
*   **公式**：`(Close / 15_MA) - 1`
*   **滯後處理 (Lag)**：`shift(1)`。
    *   *意義*：使用「昨天收盤」的乖離率來決定「今天開盤」的動作。
*   **關鍵閥值**：
    *   **> 0.0040 (Strong Trend)**：趨勢成形，日盤進場追價。
    *   **> 0.0035 (Night Start)**：夜盤因波動較小，門檻稍低即可進場。
    *   **< 0.0045 (Tech Exit)**：動能衰退，日盤強制離場。

### C. 日曆因子：連假缺口 (Holiday Gap)
**邏輯**：長假期間的不確定性 (Uncertainty) 會導致法人在假期前賣出 (Risk Off)，並在假期後確認沒事時買回 (Risk On)。
*   **公式**：`Next_Trading_Day - Current_Day` (天數差)
*   **處理方式**：Forward Looking (在週五就能知道下週一是放假的)。
*   **關鍵閥值**：
    *   **Gap > 2**：代表接下來休市超過 2 天 (例如週五接週一，Gap=3)。

---

## 3. 五層邏輯架構 (The 5-Layer Logic)

策略執行採 **「層級覆蓋 (Override)」** 機制，後面的層級權限大於前面。

### Layer 1: 初始化 (Base Case)
*   **設定**：`pos_day = 1.0`, `pos_night = 1.0`。
*   **意義**：策略本質是 Long Bias (長期看多)，除非有理由叫我不買，否則預設就是買。

### Layer 2: 宏觀風控 (Macro Filter)
*   **條件**：`Yield Shock > 0.15` (輕度衝擊)。
*   **動作**：日夜盤全數清倉 (`0.0`)。
*   **成效**：成功避開 2022 年大部份的下跌段 (當時利率持續飆升)。

### Layer 3: 節日風控 (Holiday Risk)
此層級專門處理「長假效應」：
1.  **放假前一天 (Pre-Holiday, e.g. 週五)**：
    *   **日盤 (Day)**：清倉 (`0.0`)。*防止抱單過週末。*
    *   **夜盤 (Night)**：**不動作**。*注意：週五這行的夜盤是指週四晚上，屬於正常交易時段，故保留。*
2.  **放假後第一天 (Post-Holiday, e.g. 週一/週二)**：
    *   **日盤 (Day)**：清倉 (`0.0`)。*剛開盤方向不明，先閃。*
    *   **夜盤 (Night)**：清倉 (`0.0`)。*這裡是指週五下午到週六早上的盤，為了避開週末風險而砍掉。*

### Layer 4: 技術進場 (Technical Entry)
此層級屬於「順勢交易」，在沒有宏觀風險下運作：
*   **條件**：`Yield Shock <= 0.3` (無重度衝擊)。
*   **夜盤**：`Divergence > 0.0035` -> 買進 (`1.0`)。
*   **日盤**：`Divergence > 0.0040` -> 買進 (`1.0`)。

### Layer 5: 王牌例外 (The Overrides) 👑
此層級為策略的靈魂，負責處理「例外狀況」與「反轉交易」。

#### 5.1 技術離場 (Technical Exit)
*   **條件**：`Divergence < 0.0045`。
*   **動作**：日盤清倉 (`0.0`)。
*   **意義**：這是一個嚴格的濾網，確保我們只在趨勢最強的時候持有部位，盤整期保留現金。

#### 5.2 聰明接刀 (Smart Re-entry) —— 最關鍵邏輯！
*   **情境**：剛放完長假回來 (Post-Holiday)，且 美債衝擊在安全範圍內 (`Yield Shock < 0.18`)。
*   **動作**：**日盤強制買進 (`1.0`)**。
*   **邏輯解析**：
    *   此邏輯會 **覆蓋 (Override)** 5.1 的技術離場。也就是說，**即使乖離率很低、技術面很爛，程式也會強制買進**。
    *   **理論基礎**：利用 **「節日效應 (holiday effect)」**。長假前的賣壓通常是非理性的避險 (Risk Premia)，一旦假期結束且宏觀沒事 (Safe Macro)，資金會回補湧入，造成 **「紓壓反彈 (Relief Rally)」**。
    *   此時技術指標通常落後 (因為剛被賣下來)，若等技術指標轉強再買就太慢了。這行程式碼讓策略能夠買在起漲點。

---

## 4. 績效與風險特性 (Performance Profile)

### 為什麼 2022 空頭年能賺錢？
*   **避險**：`Yield Shock` 濾網在 2022 年頻繁觸發，讓策略在大部分下跌段都保持空手。
*   **偷雞**：利用 Smart Re-entry 在少數的「死貓跳 (Dead Cat Bounce)」或「超跌反彈」中獲利 (因為反彈初期美債通常會暫時止穩)。

### 為什麼 2020 疫情崩盤受傷輕微？
*   **Yield Shock** 在市場恐慌初期就急劇飆升 (`> 0.3`)，直接觸發 Layer 2 與 Layer 4 的封鎖機制，強制空手。

### 策略盲點 (Weakness)
*   **盤整磨損**：在沒有趨勢且美債平穩的時期 (Low Volatility)，Layer 5.1 (Technical Exit) 會頻繁進出造成手續費磨損。
*   **假突破**：若長假後出現「一日行情」隨後大跌，Smart Re-entry 可能會接刀受傷 (雖然回測顯示這種情況較少)。

---
**版本註記**：v2.0 (Refined Logic)
**最後更新**：2026-01-29
